<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Insert Data to Firestore</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }
  </style>
   <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


    const firebaseConfig = {
      apiKey: "AIzaSyCG_-UFFJ4jCaeFrFRDj8v1Q6QSnWtVOrc",
      authDomain: "nyimbo-64d23.firebaseapp.com",
      projectId: "nyimbo-64d23",
      storageBucket: "nyimbo-64d23.firebasestorage.app",
      messagingSenderId: "976903482180",
      appId: "1:976903482180:web:8125b31850f1e221654511",
      measurementId: "G-0KV815N7JP"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

async function deleteByNumberField() {
  const q = query(
    collection(db, "nyimbos"),          // Replace with your collection
    where("number", "==", 269)        // Replace with your field and number
  );

  const querySnapshot = await getDocs(q);

  querySnapshot.forEach(async (document) => {
    await deleteDoc(doc(db, "nyimbos", document.id));
    console.log(`Deleted document with ID: ${document.id}`);
  });
}

deleteByNumberField();

    // Define function AFTER db is ready
   async function addNyimbo() {
  const msgEl = document.getElementById('message');
  const number = document.getElementById("number").value.trim();
  const title = document.getElementById("title").value.trim();
  const verse = document.getElementById("verse").value.trim();

  // Validation
  if (!number || !title || !verse) {
    msgEl.textContent = "Please fill in all fields before saving.";
    return; // stop execution if invalid
  }

  msgEl.textContent = 'Adding data...';

  try {
    const docRef = await addDoc(collection(db, "nyimbos"), {
      number: parseInt(number),
      title: title,
      verse: verse,
      timestamp: serverTimestamp(),
      isDeleted: false
    });
    msgEl.textContent = "Data added successfully with ID: " + docRef.id;
  } catch (error) {
    msgEl.textContent = "Error adding document: " + error.message;
  }
}


    // Expose the function globally so button can call it
    window.addNyimbo = addNyimbo;
  </script>
</head>
<body style="background-color: #1B676F;"class="bg-blue-900 flex flex-col items-center justify-center min-h-screen p-4">

  <h1 class="text-center text-white text-2xl font-bold max-w-xl">MPINGO WOBWEZELETSA SABATA LA YEHOVA</h1>
  <h2 class="text-center text-white text-2xl mt-4 max-w-xl">NYIMBO ZOIMBIRA YEHOVA</h2>
  <h3 class="text-center text-2xl font-bold bg-yellow-600 rounded-2xl p-4 text-white m-8">ADMIN</h3>

  <div  style="background-color:#4AB8CE;"class=" mt-4 rounded-2xl p-6 max-w-xl w-full">

    <form class="flex flex-col space-y-6">

      <input
        type="number"
        id="number"
        placeholder="Number"
        required
        class="rounded-2xl p-4 w-full text-black"
      />

      <input
        type="text"
        id="title"
        placeholder="Mutu wa nyimbo (uyambe ndi number e.g 30.Mesiya)"
        required
        class="rounded-2xl p-4 w-full text-black"
      />

      <textarea
        id="verse"
        placeholder="Lembani verse yonse muno..."
        required
        rows="8"
        class="rounded-2xl p-4 w-full text-black resize-none"
      ></textarea>

      <div style="background-color: #1B676F;" class="text-white p-4 flex flex-row flex-wrap space-x-4">
  

  <div class="ml-auto">
    <button
      type="button"
      onclick="addNyimbo()"
      class="bg-yellow-600 rounded-full p-3 text-white font-bold w-full sm:w-auto"
    >
      Save Nyimbo
    </button>
  </div>
</div>


      <p id="message" class="text-center text-white mt-4 min-h-[1.5em]"></p>

    </form>

  </div>

</body>

</html>
